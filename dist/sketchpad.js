!function(t,i){"object"==typeof exports&&"object"==typeof module?module.exports=i():"function"==typeof define&&define.amd?define([],i):"object"==typeof exports?exports["responsive-sketchpad"]=i():t.Sketchpad=i()}(self,(()=>(()=>{"use strict";var t={};return(()=>{var i=t,e=function(){function t(t,i){if(this.sketching=!1,this.isEraserActive=!1,this._strokes=[],this.undoneStrokes=[],this.readOnly=!1,this.aspectRatio=1,this.lineWidth=5,this.lineColor="#000",this.lineCap="round",this.lineJoin="round",this.lineMiterLimit=10,this.isInterpolationDone=!1,this.eraserSize=20,null==t)throw new Error("Must pass in a container element");null!=i&&this.setOptions(i),this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d");var e=(null==i?void 0:i.width)||t.clientWidth,o=(null==i?void 0:i.height)||e*this.aspectRatio;this.setCanvasSize(e,o),t.appendChild(this.canvas),this._strokes.length>0&&this.redraw(),this.listen()}return Object.defineProperty(t.prototype,"strokes",{get:function(){return this._strokes.map((function(t){return{points:t.points,size:t.width,color:t.color,cap:t.cap,join:t.join,miterLimit:t.miterLimit,isInterpolationDone:t.isInterpolationDone}}))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"undos",{get:function(){return this.undoneStrokes.map((function(t){return t.toObj()}))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"opts",{get:function(){return{backgroundColor:this.backgroundColor,readOnly:this.readOnly,width:this.canvas.width,height:this.canvas.height,aspectRatio:this.canvas.width/this.canvas.height,line:{size:this.lineWidth,color:this.lineColor,cap:this.lineCap,join:this.lineJoin,miterLimit:this.lineMiterLimit,isInterpolationDone:this.isInterpolationDone}}},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return{aspectRatio:this.canvas.width/this.canvas.height,strokes:this.strokes}},t.prototype.loadJSON=function(t){var i=t.strokes||[];this._strokes=i.map((function(t){return s.fromObj(t)})),this.redraw()},t.prototype.toDataURL=function(t){return this.canvas.toDataURL(t)},t.prototype.setCanvasSize=function(t,i){this.canvas.setAttribute("width",t.toString()),this.canvas.setAttribute("height",i.toString()),this.canvas.style.width=t+"px",this.canvas.style.height=i+"px"},t.prototype.getCanvasSize=function(){return{width:this.canvas.width,height:this.canvas.height}},t.prototype.setLineWidth=function(t){this.lineWidth=t},t.prototype.setEraserSize=function(t){this.eraserSize=t,this.updateEraserIndicatorSize()},t.prototype.toggleEraserMode=function(){this.isEraserActive=!this.isEraserActive},t.prototype.setLineSize=function(t){this.lineWidth=t},t.prototype.setLineColor=function(t){this.lineColor=t},t.prototype.setReadOnly=function(t){this.readOnly=t},t.prototype.undo=function(){0!==this._strokes.length&&(this.undoneStrokes.push(this._strokes.pop()),this.redraw())},t.prototype.redo=function(){0!==this.undoneStrokes.length&&(this._strokes.push(this.undoneStrokes.pop()),this.redraw())},t.prototype.clear=function(){this.undoneStrokes=[],this._strokes=[],this.redraw()},t.prototype.drawLine=function(t,i,e){this.setOptions({line:e}),t=this.getPointRelativeToCanvas(new n(t.x,t.y)),i=this.getPointRelativeToCanvas(new n(i.x,i.y)),this.pushStroke([t,i]),this.redraw()},t.prototype.resize=function(t){var i=t*this.aspectRatio;this.lineWidth=this.lineWidth*(t/this.canvas.width),this.eraserSize=this.eraserSize*(t/this.canvas.width),this.setCanvasSize(t,i),this.redraw()},t.prototype.getPointRelativeToCanvas=function(t){return{x:t.x/this.canvas.width,y:t.y/this.canvas.height,skipped:!1}},t.prototype.getLineSizeRelativeToCanvas=function(t){return t/this.canvas.width},t.prototype.updateEraserIndicatorSize=function(){var t;if(this.isEraserActive&&this.updateCircleCursor){var i=null===(t=this.canvas.parentNode)||void 0===t?void 0:t.lastChild;i.style.width="".concat(this.eraserSize,"px"),i.style.height="".concat(this.eraserSize,"px"),this.updateCircleCursor(new MouseEvent("mousemove"))}},t.prototype.setOptions=function(t){var i,e,o,n,r,a,h;t.backgroundColor&&(this.backgroundColor=t.backgroundColor),(null===(i=t.line)||void 0===i?void 0:i.size)&&(this.lineWidth=t.line.size),(null===(e=t.line)||void 0===e?void 0:e.isInterpolationDone)&&(this.isInterpolationDone=t.line.isInterpolationDone),(null===(o=t.line)||void 0===o?void 0:o.cap)&&(this.lineCap=t.line.cap),(null===(n=t.line)||void 0===n?void 0:n.join)&&(this.lineJoin=t.line.join),(null===(r=t.line)||void 0===r?void 0:r.miterLimit)&&(this.lineMiterLimit=t.line.miterLimit),t.aspectRatio&&(this.aspectRatio=t.aspectRatio),t.data&&(this._strokes=null!==(h=null===(a=t.data.strokes)||void 0===a?void 0:a.map((function(t){return s.fromObj(t)})))&&void 0!==h?h:[]),t.onDrawEnd&&(this.onDrawEnd=t.onDrawEnd)},t.prototype.getCursorRelativeToCanvas=function(t){var i,e=this.canvas.getBoundingClientRect();if(o(t)){var s=t;i=new n(s.touches[0].clientX-e.left,s.touches[0].clientY-e.top)}else{var r=t;i=new n(r.clientX-e.left,r.clientY-e.top)}return new n(i.x/this.canvas.width,i.y/this.canvas.height)},t.prototype.normalizePoint=function(t){return new n(t.x*this.canvas.width,t.y*this.canvas.height)},t.prototype.midPoint=function(t,i){return new n((t.x+i.x)/2,(t.y+i.y)/2)},t.prototype.getLineWidthRelativeToCanvas=function(t){return t/this.canvas.width},t.prototype.normalizeLineWidth=function(t){return t*this.canvas.width},t.prototype.clearCanvas=function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.backgroundColor&&(this.ctx.fillStyle=this.backgroundColor,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height))},t.prototype.drawStroke=function(t){if(null!=t.points){this.ctx.beginPath();for(var i=0;i<t.points.length-1;i++){var e=t.points[i],o=t.points[i+1];if(!(e.skipped||o&&o.skipped)){var n=this.normalizePoint(e),s=this.normalizePoint(o);this.ctx.moveTo(n.x,n.y),this.ctx.lineTo(s.x,s.y)}}this.ctx.closePath(),t.color&&(this.ctx.strokeStyle=t.color),t.width&&(this.ctx.lineWidth=this.normalizeLineWidth(t.width)),t.join&&(this.ctx.lineJoin=t.join),t.cap&&(this.ctx.lineCap=t.cap),t.miterLimit&&(this.ctx.miterLimit=t.miterLimit),this.ctx.stroke()}},t.prototype.drawQuadraticCurveStroke=function(t){if(null!=t.points){this.ctx.beginPath();var i=this.normalizePoint(t.points[0]),e=i,o=i;t.points.length>1&&(o=this.normalizePoint(this.midPoint(t.points[0],t.points[1]))),i.skipped||o&&o.skipped||(this.ctx.moveTo(i.x,i.y),this.ctx.quadraticCurveTo(e.x,e.y,o.x,o.y));for(var n=1;n<t.points.length-1;n++)i=o,e=this.normalizePoint(t.points[n]),o=this.normalizePoint(this.midPoint(t.points[n],t.points[n+1])),i.skipped||o&&o.skipped||this.ctx.quadraticCurveTo(e.x,e.y,o.x,o.y);t.color&&(this.ctx.strokeStyle=t.color),t.width&&(this.ctx.lineWidth=this.normalizeLineWidth(t.width)),t.join&&(this.ctx.lineJoin=t.join),t.cap&&(this.ctx.lineCap=t.cap),t.miterLimit&&(this.ctx.miterLimit=t.miterLimit),this.ctx.stroke()}},t.prototype.pushStroke=function(t){this._strokes.push(s.fromObj({points:t,size:this.getLineWidthRelativeToCanvas(this.lineWidth),color:this.lineColor,cap:this.lineCap,join:this.lineJoin,miterLimit:this.lineMiterLimit,isInterpolationDone:this.isInterpolationDone}))},t.prototype.pushPoint=function(t){var i=this._strokes[this._strokes.length-1];i.points&&i.points.push(t)},t.prototype.redraw=function(){var t=this;this.clearCanvas(),this.isEraserActive?this._strokes.forEach((function(i){return t.drawStroke(i)})):this._strokes.forEach((function(i,e){e===t._strokes.length-1&&t.sketching?t.drawQuadraticCurveStroke(i):t.drawStroke(i)}))},t.prototype.listen=function(){var t=this;["mousedown","touchstart"].forEach((function(i){return t.canvas.addEventListener(i,(function(i){return t.startStrokeHandler(i)}))})),["mousemove","touchmove"].forEach((function(i){return t.canvas.addEventListener(i,(function(i){return t.drawStrokeHandler(i)}))})),["mouseup","mouseleave","touchend"].forEach((function(i){return t.canvas.addEventListener(i,(function(i){return t.endStrokeHandler(i)}))}))},t.prototype.startStrokeHandler=function(t){if(t.preventDefault(),!this.readOnly){this.sketching=!0;var i=this.getCursorRelativeToCanvas(t);this.isEraserActive?this.erasePoints(i):this.pushStroke([i]),this.redraw()}},t.prototype.drawStrokeHandler=function(t){var i=this.getCursorRelativeToCanvas(t);t.preventDefault(),this.sketching&&(this.isEraserActive?this.erasePoints(i):this.pushPoint(i),this.redraw())},t.prototype.endStrokeHandler=function(t){if(t.preventDefault(),this.sketching&&(this.sketching=!1,!o(t))){var i=this.getCursorRelativeToCanvas(t);this.isEraserActive?this.erasePoints(i):(this.pushPoint(i),this.createNewStrokesAfterInterpolation(this._strokes[this._strokes.length-1],2)),this.createNewStrokesAfterErasing(),this.redraw(),this.onDrawEnd&&this.onDrawEnd()}},t.prototype.erasePoints=function(t){var i=this.getLineWidthRelativeToCanvas(this.eraserSize)/2,e=i*i;this._strokes.forEach((function(i){i.points.forEach((function(i){var o=i.x-t.x,n=i.y-t.y;o*o+n*n<=e&&(i.skipped=!0)}))}))},t.prototype.createNewStrokesAfterErasing=function(){for(var t=[],i=this.deepClone(this._strokes),e=function(e){for(var n=i[e].points||[],s={width:i[e].width,color:i[e].color,cap:i[e].cap,join:i[e].join,miterLimit:i[e].miterLimit,isInterpolationDone:i[e].isInterpolationDone,points:[],toObj:function(){return{points:s.points,size:s.width,color:s.color,cap:s.cap,join:s.join,miterLimit:s.miterLimit,isInterpolationDone:s.isInterpolationDone}}},r=0;r<n.length;r++)n[r].skipped?s.points.length>0&&(t.push(o.deepClone(s)),s.points=[]):(s.points.push(n[r]),r+1==n.length&&t.push(o.deepClone(s)))},o=this,n=0;n<i.length;n++)e(n);this._strokes=t},t.prototype.createNewStrokesAfterInterpolation=function(t,i){this._strokes.pop();var e=this.interpolateExistingShapePaths(t,i);this._strokes.push(e)},t.prototype.interpolateExistingShapePaths=function(t,i){var e=this;t.isInterpolationDone=!0;var o=(t.points||[]).map((function(t){return{x:t.x*e.canvas.width,y:t.y*e.canvas.height,skipped:!1}})),n={width:t.width,color:t.color,cap:t.cap,join:t.join,miterLimit:t.miterLimit,isInterpolationDone:t.isInterpolationDone,points:[],toObj:function(){return{points:n.points,size:n.width,color:n.color,cap:n.cap,join:n.join,miterLimit:n.miterLimit,isInterpolationDone:n.isInterpolationDone}}};n.points.push({x:o[0].x/this.canvas.width,y:o[0].y/this.canvas.height});var s=o[0],r=s,a=s;if(o.length>1){a=this.midPoint(o[0],o[1]);var h=Math.hypot(a.x-s.x,a.y-s.y),p=Math.max(1,Math.ceil(h/i));this.interpolateQuadraticCurve(s,r,a,p).forEach((function(t){n.points.push({x:t.x/e.canvas.width,y:t.y/e.canvas.height,skipped:!1})}))}for(var c=1;c<o.length-1;c++)s=a,r=o[c],a=this.midPoint(o[c],o[c+1]),h=Math.hypot(a.x-s.x,a.y-s.y),p=Math.max(1,Math.ceil(h/i)),this.interpolateQuadraticCurve(s,r,a,p).forEach((function(t){n.points.push({x:t.x/e.canvas.width,y:t.y/e.canvas.height,skipped:!1})}));return n},t.prototype.eraserModeOn=function(){this.isEraserActive=!0,this.eraserModeIndicatorOn()},t.prototype.eraserModeOff=function(){this.isEraserActive=!1,this.eraserModeIndicatorOff()},t.prototype.eraserModeIndicatorOn=function(){var t,i=this;this.canvas.style.cursor="none";var e=document.createElement("div");e.style.position="absolute",e.style.width="".concat(this.eraserSize,"px"),e.style.height="".concat(this.eraserSize,"px"),e.style.border="2px solid #000",e.style.borderRadius="50%",e.style.pointerEvents="none",e.style.zIndex="999",null===(t=this.canvas.parentNode)||void 0===t||t.appendChild(e);var o=function(t){var o=i.canvas.getBoundingClientRect(),n=t.clientX-o.left,s=t.clientY-o.top;if(n>=0&&n<=o.width&&s>=0&&s<=o.height){var r=n-i.eraserSize/2,a=s-i.eraserSize/2;e.style.left="".concat(r,"px"),e.style.top="".concat(a,"px"),e.style.display="block"}else e.style.display="none"};window.addEventListener("mousemove",o),this.updateCircleCursor=o},t.prototype.eraserModeIndicatorOff=function(){var t;if(this.canvas.style.cursor="",this.updateCircleCursor){var i=null===(t=this.canvas.parentNode)||void 0===t?void 0:t.lastChild;null==i||i.remove(),window.removeEventListener("mousemove",this.updateCircleCursor),this.updateCircleCursor=null}},t.prototype.interpolateQuadraticCurve=function(t,i,e,o){for(var n=[],s=0;s<o;s+=1){var r=s/o,a=Math.pow(1-r,2)*t.x+2*(1-r)*r*i.x+Math.pow(r,2)*e.x,h=Math.pow(1-r,2)*t.y+2*(1-r)*r*i.y+Math.pow(r,2)*e.y;n.push({x:a,y:h})}return n},t.prototype.deepClone=function(t){return JSON.parse(JSON.stringify(t))},t}();function o(t){return-1!==t.type.indexOf("touch")}i.default=e;var n=function(t,i,e){void 0===e&&(e=!1),this.x=t,this.y=i,this.skipped=e},s=function(){function t(){}return t.fromObj=function(i){var e=new t;return e.points=i.points,e.width=i.size,e.color=i.color,e.cap=i.cap,e.join=i.join,e.miterLimit=i.miterLimit,e.isInterpolationDone=i.isInterpolationDone,e},t.prototype.toObj=function(){return{points:this.points,size:this.width,color:this.color,cap:this.cap,join:this.join,miterLimit:this.miterLimit,isInterpolationDone:this.isInterpolationDone}},t}()})(),t.default})()));
//# sourceMappingURL=sketchpad.js.map